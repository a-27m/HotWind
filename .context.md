# Implementation Context & Progress

## Project: HotWind Heating Equipment Retail System

### Current Phase: Complete Implementation

### Approved Design Decisions
- 1 year of historical data (database ≤ 5GB)
- Menu-driven CLI (k9s-style UX)
- Unicode formatting, standard fonts only
- Focus on natural query optimization scenarios (cardinality/volume-based plan changes)
- Unit tests for key business logic only
- API must be unit-testable without live DB

### Implementation Status
- [x] Design documents approved (README.md, DATABASE.md, ADR.md)
- [x] Git repository initialized
- [x] Database schema script (schema.sql)
- [x] Seed data generation script (Python)
- [x] API project fully implemented
- [x] CLI project fully implemented
- [x] Unit tests for service layer
- [x] Setup documentation (SETUP.md)
- [x] Solution file with all projects

### Key Technical Notes
- No Entity Framework - uses raw SQL with Npgsql
- Repository pattern with interfaces for testability
- FIFO inventory deduction in InvoiceService
- Geometric Brownian Motion for exchange rate generation
- Backward-looking exchange rate resolution with LATERAL joins

### Data Volume Achieved
- 366 days of exchange rates (4 currency pairs) = ~1,464 rows
- 27 heater models
- 4 vendors
- 80 purchase orders with 197 lots
- 15 customers
- 300 sales invoices with 598 line items
- Estimated DB size: < 1GB

### Project Structure
```
sql-optimizer/
├── README.md, DATABASE.md, ADR.md, SETUP.md
├── HotWind.sln
├── scripts/
│   ├── schema.sql (PostgreSQL DDL)
│   ├── generate_seed_data.py (data generator)
│   └── seed-data.sql (generated data)
├── src/
│   ├── HotWind.Api/ (ASP.NET Core 9)
│   └── HotWind.Cli/ (Console with Spectre.Console)
└── tests/
    └── HotWind.Api.Tests/ (xUnit + Moq)
```

### Features Implemented

**API Endpoints:**
- POST /api/invoices (create with FIFO inventory)
- GET /api/reports/stock
- GET /api/reports/price-list
- GET /api/reports/currency-translation
- POST /api/exchangerates/generate
- GET /api/models, /api/customers

**CLI Commands:**
- Create Invoice (interactive workflow)
- Stock Report (current inventory)
- Price List Report (value comparison)
- Currency Translation Report (FX impact)
- Generate Exchange Rates (backfill)

**Database Features:**
- Complex CTEs with LATERAL joins
- Temporal queries with backward-looking rates
- Partial indexes on quantity_remaining
- Window functions for aggregations
- Helper function get_exchange_rate()

### Next Steps for Students
1. Follow SETUP.md to initialize database
2. Run API and CLI
3. Create invoices to observe FIFO deduction
4. Run EXPLAIN ANALYZE on report queries
5. Observe query plan changes as data grows
6. Experiment with index strategies

Last Updated: 2025-10-27 (Implementation Complete)
